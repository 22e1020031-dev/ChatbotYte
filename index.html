<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tr·ª£ l√≠ Y t·∫ø</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-slate-900 text-white">
  <main class="grid grid-cols-[70%_30%] gap-4 h-screen p-4">
    
    <!-- √î Chat (70%) -->
    <section class="bg-slate-800 rounded-2xl shadow-sm border border-slate-700 flex flex-col">
      <header class="p-4 border-b border-slate-700">
        <h1 class="text-2xl font-bold">üí¨ Tr·ª£ l√≠ Y t·∫ø</h1>
      </header>
      <div id="chatHistory" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
      <div class="border-t border-slate-700 p-3">
        <div class="flex gap-2 items-end">
          <textarea id="userInput" rows="2" placeholder="B·∫°n mu·ªën h·ªèi g√¨?"
            class="flex-1 resize-none px-3 py-2 rounded-2xl bg-slate-900 border border-slate-700 text-white"></textarea>
          <button id="sendBtn" class="px-4 py-2 rounded-2xl bg-indigo-600 text-white">G·ª≠i</button>
        </div>
        <div class="mt-3">
          <label class="block text-sm mb-1">Ch·ªçn gi·ªçng ƒë·ªçc:</label>
          <select id="voiceSelect" class="w-full px-2 py-2 rounded bg-slate-900 border border-slate-700 text-white"></select>
        </div>
      </div>
    </section>

    <!-- √î ƒê·∫∑t l·ªãch (30%) -->
    <section class="bg-slate-800 rounded-2xl shadow-sm border border-slate-700 flex flex-col">
      <header class="p-4 border-b border-slate-700">
        <h2 class="text-xl font-semibold">üìÖ ƒê·∫∑t l·ªãch kh√°m</h2>
      </header>
      <div class="flex-1 p-4 overflow-y-auto">
        <h3 class="font-medium mb-2">L·ªãch h·∫πn c·ªßa t√¥i</h3>
        <p class="text-sm text-slate-400 mb-4">B·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o.</p>
        <h3 class="font-medium mb-2">ƒê·∫∑t l·ªãch nhanh</h3>
        <form class="space-y-3">
          <input type="text" placeholder="Ph√≤ng kh√°m"
            class="w-full px-3 py-2 border border-slate-700 rounded-lg bg-slate-900 text-white">
          <input type="date"
            class="w-full px-3 py-2 border border-slate-700 rounded-lg bg-slate-900 text-white">
          <input type="time"
            class="w-full px-3 py-2 border border-slate-700 rounded-lg bg-slate-900 text-white">
          <textarea placeholder="Ghi ch√∫"
            class="w-full px-3 py-2 border border-slate-700 rounded-lg bg-slate-900 text-white"></textarea>
          <button type="submit"
            class="w-full px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500">
            ƒê·∫∑t l·ªãch
          </button>
        </form>
      </div>
    </section>

  </main>

  <script>
    const chatHistory = document.getElementById("chatHistory");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const voiceSelect = document.getElementById("voiceSelect");

    // Load danh s√°ch gi·ªçng ƒë·ªçc
    function loadVoices() {
      const voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = voices.map(v => 
        `<option value="${v.name}">${v.name} (${v.lang})</option>`
      ).join("");
    }
    speechSynthesis.onvoiceschanged = loadVoices;

    // H√†m ƒë·ªçc vƒÉn b·∫£n
    function speakText(text) {
      if (!text) return;
      speechSynthesis.cancel(); // ng·∫Øt gi·ªçng c≈©
      const utter = new SpeechSynthesisUtterance(text.replace(/[#*_`>]/g,""));
      const selectedVoice = voiceSelect.value;
      if (selectedVoice) {
        const voices = speechSynthesis.getVoices();
        const match = voices.find(v => v.name === selectedVoice);
        if (match) utter.voice = match;
      }
      speechSynthesis.speak(utter);
    }

    // Th√™m tin nh·∫Øn v√†o chat
    function addMsg(role, text) {
      const wrap = document.createElement('div');
      wrap.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
      const bubble = document.createElement('div');
      bubble.className = `max-w-[85%] px-3 py-2 rounded-2xl shadow-sm border text-sm whitespace-pre-wrap ${
        role === 'user'
          ? 'bg-indigo-600 text-white border-indigo-500'
          : 'bg-slate-900 border-slate-700'
      }`;
      bubble.innerHTML = marked.parse(text);
      wrap.appendChild(bubble);

      // N·∫øu l√† bot th√¨ th√™m n√∫t ƒë·ªçc/d·ª´ng
      if (role === "assistant") {
        const controls = document.createElement("div");
        controls.className = "flex gap-2 ml-2";

        const readBtn = document.createElement("button");
        readBtn.textContent = "üîä ƒê·ªçc";
        readBtn.className = "px-2 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500";
        readBtn.onclick = () => speakText(text);

        const stopBtn = document.createElement("button");
        stopBtn.textContent = "‚èπ D·ª´ng";
        stopBtn.className = "px-2 py-1 rounded bg-gray-600 text-white text-xs hover:bg-gray-500";
        stopBtn.onclick = () => speechSynthesis.cancel();

        controls.appendChild(readBtn);
        controls.appendChild(stopBtn);
        wrap.appendChild(controls);
      }

      chatHistory.appendChild(wrap);
      chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    // G·ª≠i tin nh·∫Øn
    sendBtn.onclick = () => {
      const text = userInput.value.trim();
      if (!text) return;
      addMsg("user", text);
      userInput.value = "";
      // Gi·∫£ l·∫≠p ph·∫£n h·ªìi bot
      setTimeout(() => {
        addMsg("assistant", "Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?");
      }, 800);
    };
  </script>
</body>
</html>
